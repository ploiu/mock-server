/**
 * MIT License
 * 
 * Copyright (c) 2024 ploiu
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
if(!customElements.get("accordion-element")){let o=0;globalThis.accordions=[];class n extends HTMLElement{#n;#h;#i;#o;#s;#e;#t;#c;#l;#r;constructor({title:t,id:e,isOpen:i,group:s}={}){super(),this.#n=t??this.dataset.title??"",this.#h=e??this.dataset.id??o++,this.#i=i??this.dataset.isOpen??!1,this.#o=s??this.dataset.group??"",globalThis.accordions.push(this),this.#t=null}#u(){let t=this.querySelector("div.ploiu-accordion-title");if(t)return t.addEventListener("click",()=>this.toggle()),t;{let e=document.createElement("div");return e.classList.add("ploiu-accordion-title"),e.innerText=this.#n,e.addEventListener("click",()=>this.toggle()),e}}#g(){let t=this.querySelector("div.ploiu-accordion-body");if(t)return t;{let e=document.createElement("div");e.classList.add("ploiu-accordion-body");let i=[...this.childNodes].filter(s=>!s.classList?.contains("ploiu-accordion-title"));for(let s of i){let r=s;e.appendChild(r.cloneNode(!0)),r.remove()}return e}}#d(){let t=[],e=this.parentNode;for(;e?.parentNode;)t.push(e.parentNode),e=e.parentNode;return t.find(i=>i?.tagName==="ACCORDION-ELEMENT")||null}#f(){let t=[],e=this.#t;for(;e;)t.push(e),e=e.#d();return t}#a(t){if(this.#t?.isOpen){let i=Number.parseFloat(this.#t.bodyElement.style.height.replace("px",""))+t;this.#t.bodyElement.style.height=i+"px",this.#t.#a(t)}}#p(t){if(this.#t?.isOpen){let i=Number.parseFloat(this.#t.bodyElement.style.height.replace("px",""))-t;this.#t.bodyElement.style.height=i+"px",this.#t.#p(t)}}get accordionId(){return this.#h}get group(){return this.#o}set group(t){this.#o=t,this.dataset.group=t}get title(){return this.#n}set title(t){if(typeof t=="string")this.#n=t,this.isConnected&&(this.#s.innerText=t);else if(t instanceof Node){if(!this.isConnected)throw"Can't set an accordion element title to a node when it hasn't been appended to the document!";this.#n="",this.#s.innerText="",[...this.#s.children].forEach(e=>e.remove()),this.#s.appendChild(t)}}get isOpen(){return this.#i}get bodyElement(){return this.#e}set body(t){if(!this.isConnected)throw"Can't set an accordion element body when it hasn't been appended to the document!";Array.from(this.#e.children).forEach(e=>e?.remove()),this.#e.appendChild(t)}expand(){let t=this.#f();n.findAccordionsByGroup(this.#o).filter(e=>e!==this&&!t.includes(e)&&this.#t===e.#t).forEach(e=>e.collapse()),this.#i=!0,this.#e.style.height=`${this.#e.scrollHeight}px`,this.#a(this.#e.scrollHeight),this.classList.add("open")}collapse(){this.#i&&(this.#i=!1,this.#t&&this.#p(this.bodyElement.scrollHeight),this.#e.style.height="0",this.classList.remove("open"),Array.from(this.querySelectorAll("accordion-element")).forEach(t=>t.collapse()))}toggle(){this.#i?this.collapse():this.expand()}connectedCallback(){!this.#c&&this.isConnected&&(this.#s=this.#u(),this.#e=this.#g(),this.appendChild(this.#s),this.appendChild(this.#e),(this.dataset.open!==void 0||this.#i)&&this.expand(),this.#t=this.#d(),this.#t!==null?this.#l=this.#t.scrollHeight:this.#l=0,this.#m(),this.#c=!0)}disconnectedCallback(){this.#r&&this.#r.disconnect()}#m(){this.#r=new MutationObserver(t=>{for(let e of t)e.type==="childList"&&this.#i&&this.#y()}),this.#r.observe(this,{childList:!0,subtree:!0})}#y(){this.#t&&(this.#e.style.transition="none"),this.#e.style.height="auto";let t=this.#e.scrollHeight+"px";this.#e.style.transition="var(--accordion-expand-rate)",requestAnimationFrame(()=>{this.#e.style.height=t})}static findAccordionById(t){try{return globalThis.accordions.filter(e=>e.id===t)[0]}catch{return null}}static findAccordionsByGroup(t){return[...document.querySelectorAll("accordion-element")].filter(e=>e.group?.toLowerCase()===t.toLowerCase())}}class h extends HTMLElement{connectedCallback(){this.isConnected&&(Array.from(this.querySelectorAll("accordion-element")).forEach(t=>t.group=`fan-${o}`),o++)}}customElements.define("accordion-element",n),customElements.define("accordion-fan",h),globalThis.AccordionElement=n}